<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<meta charset="utf-8">
<style>
	input[name='textVal'],input[name='timeVal']{
		width:50px;
	}
	.unit li,.time li{
		margin-bottom:10px;
	}
</style>
<head th:include="include :: header"></head>
<link th:href="@{/ajax/libs/layui/css/layui.css}" rel="stylesheet"/>
<body class="white-bg">
	<div class="wrapper wrapper-content animated fadeInRight ibox-content">
		<form class="form-horizontal m" id="form-article-edit" th:object="${article}">
			<input name="id"  type="hidden"  th:field="*{id}" />
			<div class="col-md-12">
				<div class="form-group">
					<label class="col-sm-3 control-label">标题：</label>
					<div class="col-sm-9">
						<input type="text" name="title" class="form-control" th:field="*{title}">
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-3 control-label">副标题：</label>
					<div class="col-sm-9">
						<textarea type="text" name="shortText" class="form-control" th:field="*{shortText}"></textarea>
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-3 control-label">分类：</label>
					<div class="col-sm-9">
						<select name="classifyId" th:with="type=${classify}" th:field="*{classifyId}">
							<option th:each="dict : ${type}" th:selected="${dict.id eq classifyId}" th:text="${dict.name}" th:value="${dict.id}"></option>
						</select>
					</div>
				</div>

				<div id="tips" class="form-group">
					<label class="col-sm-3 control-label">警示：</label>
					<div class="col-sm-8">
						<div class="onoffswitch">
							<input type="checkbox"th:checked="${article.caution eq 1 ? true : false}" class="onoffswitch-checkbox" id="caution" name="caution">
							<label class="onoffswitch-label" for="caution">
								<span class="onoffswitch-inner"></span>
								<span class="onoffswitch-switch"></span>
							</label>
						</div>
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-3 control-label">正文：</label>
					<div class="col-sm-9">
						<textarea type="text" id="bjq" name="fullText" class="form-control"  th:field="*{fullText}" ></textarea>
					</div>
				</div>
			</div>
		</form>
	</div>
	<div th:include="include::footer"></div>
	<script th:src="@{/ajax/libs/select/select2.js}"></script>
	<script th:src="@{/ajax/libs/layui/layui.all.js}"></script>
	<script>
        var layedit;
        var editor;
        var isFirst = true; /* 首次执行提交 */
        layui.use('layedit', function(){
            layedit = layui.layedit;
            layedit.set({
                uploadImage: {
                    url: '/content/article/uploadImage' //接口url
                    ,type: 'post' //默认post
                }
            });
            editor = layedit.build('bjq');
        });
		$("#form-article-edit").validate({
			submitHandler:function(form){
				edit();
			}
		});
		
		$(function(){
			if($("#classifyId option:selected").val()=='4'){
    			$("#tips").hide();
    		}else{
    			$("#tips").show();
    		}
		})
		$("#classifyId").on("change",function(){
        	if($("#classifyId option:selected").val()=='4'){
    			$("#tips").hide();
    		}else{
    			$("#tips").show();
    		}
        });
        
		function submitHandler() {
			if ($.validate.form()) {
				if(isFirst){
					edit();
				}
			}
		}

		function edit() {
            var content=layedit.getContent(editor);
			var id = $("input[name='id']").val();
			var title = $("input[name='title']").val();
            var shortText = $("textarea[name='shortText']").val();
			var classifyId = $("select[name='classifyId']").val();
			var caution = $("input[name='caution']").is(':checked') == true ? 1 : 0;
			var fullText = content;
			$.ajax({
				cache : true,
				type : "POST",
				url : ctx + "content/notice/edit",
				data : {
					id: id,
					title: title,
					shortText:shortText,
					caution: caution,
					classifyId:classifyId,
					fullText: fullText
				},
				async : false,
				error : function(request) {
					$.modal.alertError("系统错误");
				},
				success : function(data) {
					isFirst = false;
					$.operate.saveSuccess(data);
				}
			});
		}
    </script>
</body>
</html>
