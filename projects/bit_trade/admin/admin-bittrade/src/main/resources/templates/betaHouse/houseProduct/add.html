<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<meta charset="utf-8">
<meta name="renderer" content="webkit">
<!--<link rel="stylesheet" href="static/build/layui.css" media="all">-->
<style>
    .banner-box {
        width: 350px;
        height: 150px;
        border: 1px solid #e5e6e7;
        background-size: 45px 45px;
        position: relative;
        box-sizing: content-box;
    }

    .downloadPic {
        width: 100%;
        height: 100%;
        opacity: 0;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 2;
    }

    .banner-img {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 1;
    }

    .add-img {
        position: absolute;
        width: 24px;
        height: 24px;
        line-height: 24px;
        text-align: center;
        left: 0;
        bottom: 0;
        top: 0;
        right: 0;
        margin: auto;
        font-size: 32px;
        z-index: 0;
    }

    .banner-size {
        float: right !important;
        margin-top: -15px;
    }
</style>

<head th:include="include :: header"></head>
<body class="white-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <form class="form-horizontal m" id="form-houseProduct-add">

        <div class="form-group">
            <label class="col-sm-3 control-label">商品名称：</label>
            <div class="col-sm-9">
                <input class="form-control" type="text" name="name" id="name" required>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">商城展示位置：</label>
            <div class="col-sm-2">
                <select class="form-control" id="showPosition" name="showPosition"
                        th:with="type=${@dict.getType('house_product_showPosition')}"
                        style="width: auto;" onchange="textchanged(this.value)">
                    <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                            th:value="${dict.dictValue}"></option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">商品类别：</label>
            <div class="col-sm-2">
                <select class="form-control" id="type" name="type"
                        th:with="type=${@dict.getType('house_product_status')}"
                        style="width: auto;">
                    <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                            th:value="${dict.dictValue}"></option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">消耗类别：</label>
            <div class="col-sm-2">
                <select class="form-control" id="expendType" name="expendType"
                        th:with="type=${@dict.getType('house_product_expendType')}"
                        style="width: auto;">
                    <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                            th:value="${dict.dictValue}"></option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">出售状态：</label>
            <div class="col-sm-2">
                <select class="form-control" id="status" name="status"
                        th:with="type=${@dict.getType('beta_HouseProduct_status')}">
                    <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                            th:value="${dict.dictValue}"></option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">有效对象：</label>
            <div class="col-sm-9">
                <input class="form-control" type="text" name="beSuitable" id="beSuitable" placeholder="母狗"
                       disabled="disabled">
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">商品描述：</label>
            <div class="col-sm-9">
                <textarea class="form-control" type="text" name="describe" id="describe"></textarea>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label ">商品数量：</label>
            <div class="col-sm-9">
                <input class="form-control" type="text" name="stockCount" id="stockCount"
                       placeholder="默认为-1,为'-1'将不限制数量" maxlength="8">
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label ">商品总量：</label>
            <div class="col-sm-9">
                <input class="form-control" type="text" name="totalCount" id="totalCount"
                       placeholder="默认为-1,为'-1'将不限制数量" maxlength="8">
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label ">购买总量限制：</label>
            <div class="col-sm-9">
                <input class="form-control" type="text" name="buyLimit" id="buyLimit"
                       placeholder="默认为1" maxlength="8">
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">叠加使用限制(次)：</label>
            <div class="col-sm-9">
                <input id="overlayLimit" name="overlayLimit" class="form-control"
                       placeholder="默认为-1,为'-1'将不限制数量" maxlength="8">
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">力量：</label>
            <div class="col-sm-9">
                <input id="power" name="power" class="form-control" placeholder="增加力量" maxlength="8">
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">敏捷：</label>
            <div class="col-sm-9">
                <input id="agility" name="agility" class="form-control" placeholder="增加敏捷" maxlength="8">
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">体力：</label>
            <div class="col-sm-9">
                <input id="stamina" name="stamina" class="form-control" placeholder="增加体力" maxlength="8"/>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">智力：</label>
            <div class="col-sm-9">
                <input id="intelligence" name="intelligence" class="form-control" placeholder="增加智力"
                       maxlength="8"/>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">魅力：</label>
            <div class="col-sm-9">
                <input id="charm" name="charm" class="form-control" placeholder="增加魅力" maxlength="8"/>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">使用有效期：</label>
            <div class="col-sm-9">
                <input id="validityPeriod" name="validityPeriod" class="form-control" placeholder="天" maxlength="8"/>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label ">价格：</label>
            <div class="col-sm-9">
                <input class="form-control" type="text" name="price" id="price" maxlength="8" required>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">加速时间：</label>
            <div class="col-sm-3">
                <li class="select-time">
                    <input type="text" class="form-control" id="accelerationTime" name="accelerationTime" placeholder="加速小时" maxlength="3"/>
                </li>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">是否送币：</label>
            <div class="col-sm-3">
                <select class="form-control" id="giveCurrencyStatus" name="giveCurrencyStatus"
                        th:with="type=${@dict.getType('give_currency_status')}" required >
                    <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                            th:value="${dict.dictValue}"></option>
                </select>
            </div>
        </div>
        <div class="form-group give">
            <label class="col-sm-3 control-label">币种：</label>
            <div class="col-sm-3">
                <select class="form-control" id="accountConfigId" name="accountConfigId"
                        th:with="accountConfigList=${accountConfigList}"
                        style="width: auto;">
                    <option th:each="ac : ${accountConfigList}" th:text="${ac.name}"
                            th:value="${ac.id}"></option>
                </select>
            </div>
        </div>
        <div class="form-group give" >
            <label class="col-sm-3 control-label ">数量 ：</label>
            <div class="col-sm-9">
                <input class="form-control" type="number" name="accountNum" id="accountNum" maxlength="8" min="1">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">备注：</label>
            <div class="col-sm-9">
                <textarea class="form-control" type="text" name="remark" id="remark"></textarea>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">展示图：</label>
            <div class="col-sm-9">
                <div class="banner-box">
                    <input class="downloadPic" type="file" name="file" id="downloadPic" accept="image/*">
                    <img class="banner-img" src="" alt="" id="image">
                    <p class="add-img">+</p>
                </div>
            </div>
            <p class="col-sm-3 banner-size">700*300px</p>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">实景图：</label>
            <div class="col-sm-9">
                <div class="banner-box">
                    <input class="downloadPic" type="file" name="file" id="downloadPics" accept="sceneryImg/*">
                    <img class="banner-img" src="" alt="" id="sceneryImg">
                    <p class="add-img">+</p>
                </div>
            </div>
            <p class="col-sm-3 banner-size">282*225</p>
        </div>

    </form>
</div>
<div th:include="include::footer"></div>
<script th:src="@{/ajax/libs/select/select2.js}"></script>
<script>
    // function textchanged(value) {
    //     if (value == 5) {
    //         document.getElementById("stockCount").disabled = true;
    //         document.getElementById("totalCount").disabled = true;
    //         document.getElementById("buyLimit").disabled = true;
    //         document.getElementById("overlayLimit").disabled = true;
    //         document.getElementById("power").disabled = true;
    //         document.getElementById("agility").disabled = true;
    //         document.getElementById("stamina").disabled = true;
    //         document.getElementById("intelligence").disabled = true;
    //         document.getElementById("charm").disabled = true;
    //         document.getElementById("validityPeriod").disabled = true;
    //         document.getElementById("accelerationTime").disabled = true;
    //     }else{
    //         document.getElementById("stockCount").disabled = false;
    //         document.getElementById("totalCount").disabled = false;
    //         document.getElementById("buyLimit").disabled = false;
    //         document.getElementById("overlayLimit").disabled = false;
    //         document.getElementById("power").disabled = false;
    //         document.getElementById("agility").disabled = false;
    //         document.getElementById("stamina").disabled = false;
    //         document.getElementById("intelligence").disabled = false;
    //         document.getElementById("charm").disabled = false;
    //         document.getElementById("validityPeriod").disabled = false;
    //         if(value==8){
    //             document.getElementById("accelerationTime").disabled =false;
    //         }else {
    //             document.getElementById("accelerationTime").disabled =true;
    //         }
    //     }
    // }

    // 是道具就能展示时间
    function textchanged(value) {
        if (value == 3) {
            document.getElementById("accelerationTime").disabled =false;
        }else{
            document.getElementById("accelerationTime").disabled =true;
        }
    }

    var isFirst = true;
    /* 首次执行提交 */
    $("#form-houseProduct-add").validate({
        rules: {
            title: {
                required: true
            },
            sort: {
                required: true
            },
            bannerImgUrl: {
                required: true
            }
        }
    });

    var prefix = ctx + "betaHouse/houseProduct";

    /* 图片在前端预览 */
    var pictureSuffix = "";
    var pictureBase64 = "";
    $("#downloadPic").change(function (e, type) {
        var files = e.target.files;
        var file = files[0];
        var fileSize = file.size;
        if (!/\/(?:jpeg|jpg|png)/i.test(file.type)) {
            $.modal.alertError("上传图片格式只能为jpeg,jpg,png");
            return;
        }
        var reader = new FileReader();
        reader.onload = function () {
            if (fileSize - 0 > 1048576) {
                $.modal.alertError("上传图片不能超过1M");
                return false;
            }
            var result = this.result;
            $("#image").attr("src", result);
            pictureSuffix = file.type.split("/")[1];
            pictureBase64 = result.split(",")[1];
        };
        reader.readAsDataURL(file);
    });


    /* 实景图片 */
    var sceneryPictureSuffix = "";
    var sceneryPictureBase64 = "";
    $("#downloadPics").change(function (e, type) {
        var files = e.target.files;
        var file = files[0];
        var fileSize = file.size;
        if (!/\/(?:jpg|jpeg|png)/i.test(file.type)) {
            $.modal.alertError("上传图片格式只能为jpeg,jpg,png");
            return;
        }
        var reader = new FileReader();
        reader.onload = function () {
            if (fileSize - 0 > 1048576) {
                $.modal.alertError("上传图片不能超过1M");
                return false;
            }
            var result = this.result;
            $("#sceneryImg").attr("src", result);
            sceneryPictureSuffix = file.type.split("/")[1];
            sceneryPictureBase64 = result.split(",")[1];
        };
        reader.readAsDataURL(file);
    });

    function submitHandler() {
        if ($.validate.form()) {
            if (isFirst) {
                add();
            }
        }
    }

    function add() {
        var image = $("#image").attr("src");
        if (image == null || image == "" || image == undefined) {
            $.modal.alertError("请上传图片");
            return;
        }
        var name = $("input[name='name']").val();
        var type = document.getElementById("type").value
        var status = document.getElementById("status").value
        var stockCount = document.getElementById("stockCount").value
        var remark = document.getElementById("remark").value
        var totalCount = $("input[name='totalCount']").val();
        var price = $("input[name='price']").val();
        var buyLimit = $("input[name='buyLimit']").val();
        var power = $("input[name='power']").val();
        var agility = $("input[name='agility']").val();
        var stamina = $("input[name='stamina']").val();
        var intelligence = $("input[name='intelligence']").val();
        var charm = $("input[name='charm']").val();
        var overlayLimit = $("input[name='overlayLimit']").val();
        var validityPeriod = document.getElementById("validityPeriod").value
        var showPosition = document.getElementById("showPosition").value
        var expendType = document.getElementById("expendType").value
        var describe = document.getElementById("describe").value
        var accelerationTime = document.getElementById("accelerationTime").value
        var giveCurrencyStatus = $("#giveCurrencyStatus").val();
        var accountConfigId = $("#accountConfigId").val();
        var accountNum = $("input[name='accountNum']").val();
        $.ajax({
            cache: true,
            type: "POST",
            url: prefix + "/saveHouseProduct",
            data: {
                "accelerationTime": accelerationTime,
                "name": name,
                "type": type,
                "beSuitable": 1,
                "describe": describe,
                "remark": remark,
                "price": price,
                "totalCount": totalCount,
                "stockCount": stockCount,
                "buyLimit": buyLimit,
                "power": power,
                "agility": agility,
                "stamina": stamina,
                "intelligence": intelligence,
                "charm": charm,
                "status": status,
                "pictureSuffix": pictureSuffix,
                "pictureBase64": pictureBase64,
                "sceneryPictureSuffix": sceneryPictureSuffix ,
                 "sceneryPictureBase64":sceneryPictureBase64 ,
                "overlayLimit": overlayLimit,
                "validityPeriod": validityPeriod,
                "showPosition": showPosition,
                "expendType": expendType,
                "giveCurrencyStatus": giveCurrencyStatus,
                "accountConfigId": accountConfigId,
                "accountNum": accountNum
            },
            async: false,
            error: function (request) {
                $.modal.alertError("系统错误");
            },
            success: function (data) {
                if (data.code == web_status.SUCCESS) {
                    isFirst = false;
                    $.operate.saveSuccess(data);
                } else {
                    $.modal.alertError(data.message);
                }
            }
        });
    };

    function showMask() {
        $("#mask").css("height", $(document).height());
        $("#mask").css("width", $(document).width());
        $("#mask").show();

        $('#icon').addClass('fa fa-circle-o-notch fa-spin');
        $('#icon').parent().css("padding-top", $(document).height() / 3);
        $('#icon').parent().css("padding-left", $(document).width() / 2);
        $('#icon').parent().addClass('center-block');
        $("#icon").parent().show();
        setTimeout(hideMask, 5000);
    }

    //隐藏遮罩层
    function hideMask() {
        $("#mask").hide();
        $("#icon").parent().hide();
    }

    $(function () {
        giveHide();
        $('#giveCurrencyStatus').on('change',function () {
            giveHide();
        })
    });
    //是否送币显示与隐藏
    function giveHide() {
        var val=$('#giveCurrencyStatus').val();
        if(val==0){
            $('.give').attr("style","display:none;");//隐藏div
        }else{
            $('.give').attr("style","display:block;");//显示div
        }
    }

</script>
</body>
</html>
