<!DOCTYPE html><html class="x-admin-sm" xmlns:v-on="http://www.w3.org/1999/xhtml" xmlns:v-bind="http://www.w3.org/1999/xhtml"><head>  <meta charset="UTF-8">  <title>全部用户</title>  <meta name="renderer" content="webkit">  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">  <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8" />  <link rel="stylesheet" href="/statics/css/font.css">  <link rel="stylesheet" href="/statics/css/xadmin.css">  <link rel="icon" href="/statics/images/favicon.ico" type="image/x-icon">  <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>  <script type="text/javascript" src="/statics/lib/layui/layui.js" charset="utf-8"></script>  <script type="text/javascript" src="/statics/js/xadmin.js"></script>  <script type="text/javascript" src="/statics/js/cookie.js"></script>  <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->  <!--[if lt IE 9]>  <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>  <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>  <![endif]--></head><body><div class="x-nav">      <span class="layui-breadcrumb">        <a href="">首页</a>        <a href="">用户管理</a>        <a>          <cite>全部用户</cite></a>      </span>  <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:12px;float:right" href="javascript:location.replace(location.href);" title="刷新">    <i class="layui-icon" style="line-height:25px"><img src="/statics/images/refresh2.png" alt="" style="width:16px;"></i></a></div><div class="x-body" id="alluser">  <div class="layui-row">    <form class="layui-form layui-col-md12 x-so">      <!--<input class="layui-input" placeholder="开始日" name="start" id="start">-->      <!--<input class="layui-input" placeholder="截止日" name="end" id="end">-->      <input type="text" name="username"  placeholder="请输入用户名" autocomplete="off" class="layui-input" v-model="username">        <button class="layui-btn"  @click.prevent="sreachs()"><i class="layui-icon">&#xe615;</i></button>    </form>  </div>  <xblock>    <!--<button class="layui-btn layui-btn-danger" onclick="delAll()"><i class="layui-icon"></i>批量删除</button>-->    <button class="layui-btn" onclick="x_admin_show('添加用户','/admin-add',600,500)"><i class="layui-icon"></i>添加</button>    <span class="x-right" style="line-height:40px">共有数据：<font class="particular"><b>{{totalNum}}</b></font>条 <font class="particular"><b>{{pageNum}}/{{totalPages}}</b></font> 每页<font class="particular"><b>{{pageSize}}</b></font>条</span>  </xblock>  <table class="layui-table">    <thead>    <tr>      <th>        <div class="layui-unselect header layui-form-checkbox" lay-skin="primary"><i class="layui-icon">&#xe605;</i></div>      </th>      <th>ID</th>      <th>登录名</th>      <th>昵称</th>      <th>角色</th>      <!--<th>加入时间</th>-->      <th>状态</th>      <th>操作</th>    </thead>    <tbody>    <tr v-for="b in body">      <td>        <div class="layui-unselect layui-form-checkbox" lay-skin="primary" data-id='2'><i class="layui-icon">&#xe605;</i></div>      </td>      <td>{{b.uid}}</td>      <td>{{b.username}}</td>      <td>{{b.nickname}}</td>      <td>{{b.roleList[0] | forRole}}</td>      <!--<td>{{body.create}}</td>-->      <td class="td-status">        <span class="layui-btn layui-btn-normal layui-btn-mini layui-btn-disabled" v-if="b.state == 1">已禁用</span>        <span class="layui-btn layui-btn-normal layui-btn-mini" v-else="b.state == 0"  ref="openText">已启用</span>      </td>      <td class="td-manage">        <!--<a onclick="member_stop(this,'10001',b.username)" href="javascript:;"  title="启用" v-if="b.state == 1">-->          <!--<i class="layui-icon">&#xe62f;</i>-->        <!--</a>-->        <!--<a onclick="member_stop(this,'10001',b.username)" href="javascript:;"  title="禁用" v-else>-->          <!--<i class="layui-icon">&#xe601;</i>-->        <!--</a>-->        <a @click="member_stop(b.username,0)" href="javascript:;"  title="启用" v-if="b.state == 1">          <i class="layui-icon">&#xe62f;</i>        </a>        <a @click="member_stop(b.username,1)" href="javascript:;"  title="禁用" v-else>          <i class="layui-icon">&#xe601;</i>        </a>        <a title="编辑"  @click="show(b.username,b.roleList[0].role)" href="javascript:;">          <i class="layui-icon">&#xe642;</i>        </a>        <a title="删除" @click="member_del(b)" href="javascript:;">          <i class="layui-icon">&#xe640;</i>        </a>      </td>    </tr>    </tbody>  </table>  <div class="page">    <a v-if="pageNum>1" v-on:click="pageNum--,pageClick()">&lt;&lt;</a>    <a v-if="pageNum==1" class="num current">&lt;&lt;</a>    <a v-for="index in indexs" v-bind:class="{'sefirst' : pageNum == index}" v-on:click="btnClick(index)">{{index}}</a>    <a v-if="pageNum!=totalPages" v-on:click="pageNum++,pageClick()" class="num">&gt;&gt;</a>    <a v-if="pageNum == totalPages" class="banclik">&gt;&gt;</a>    <font style="color:#999;">到第</font>    <input type="text" class="pageNumber" v-model="pageNumber">    <font style="color:#999;">页</font>    <button  class="pageOK" v-on:click="btnOK()">确定</button>  </div></div><script>    layui.use('laydate', function(){        var laydate = layui.laydate;        //执行一个laydate实例        laydate.render({            elem: '#start' //指定元素        });        //执行一个laydate实例        laydate.render({            elem: '#end' //指定元素        });    });    // var username = document.getElementById("userName0");    // var i  = "{'state':'1','username':'"+username.innerText+"'}";    // console.log(i)    // console.log(111111)    /*用户-删除*/    function member_del(obj,id){        layer.confirm('确认要删除吗？',function(index){            //发异步删除数据            $(obj).parents("tr").remove();            layer.msg('已删除!',{icon:1,time:1000});        });    }    function delAll (argument) {        var data = tableCheck.getData();        layer.confirm('确认要删除吗？'+data,function(index){            $.ajax({ type:'post',url: "/editUser", data: "{'state':'1','username':'"+username+"'}",dataType: "json",contentType: "application/json;charset=UTF-8",                success: function(date){                    //捉到所有被选中的，发异步进行删除                    layer.msg('删除成功', {icon: 1});                    $(".layui-form-checked").not('.header').parents('tr').remove();                }            });        });    }</script><script src="/statics/js/vue.min.js"></script><script src="/statics/js/vue-resource.js"></script><!--<script src="/statics/js/index.js"></script>--><script>    var alluser = new Vue({        el: '#alluser',        data: {            body: [],            pageNum:1, //当前页数            pageSize:1, //每页数量            isFirstPage:false,            totalPages:0, //总页数            isLastPage:false,            totalNum:0, //总数量            username:'',            pageNumber:1,        },        mounted:function () {            var _this = this;            this.$http.post('/findAllUser',{},{emulateJSON:true}).then(function(res){                // console.log(res.body)                // console.log("/findAllUser")                _this.body = res.body.list                _this.pageNum=res.body.pageNum                _this.pageSize=res.body.pageSize                _this.isFirstPage=res.body.isFirstPage                _this.totalPages=res.body.pages                _this.isLastPage=res.body.isLastPage                _this.totalNum = res.body.total            },function(res){                console.log(res.status);            });        },        methods:{            sreachs:function () {                var _this = this;                console.log(_this.username)                $.ajax({ type:'post',url: "/findUserByUserName", data: {username:_this.username}, contentType: "application/x-www-form-urlencoded",                    success: function(res){                        var dataObj=eval("("+res+")");                        console.log("/sreachs")                        _this.body = dataObj                    }                });            },            member_stop(name,state){                config={                    headers:{'Content-Type':'application/json;charset=UTF-8'},                }                this.$http.post('/editUser',{username:name,state:state},config).then(function(res){                    if(null == res){                        // self.$router.push({path:'/login'})                    }else{                        location.reload();                    }                },function(res){                    console.log(res.status);                });            },            member_del(b){                layer.confirm('确认要删除吗？',function(index){                    $.ajax({ type:'post',url: "/delUser", data: JSON.stringify(b), contentType: "application/json",                        success: function(date){                            //捉到所有被选中的，发异步进行删除                            layer.msg('删除成功', {icon: 1});                            $(".layui-form-checked").not('.header').parents('tr').remove();                            location.reload();                        }                    });                });            },            show(username,role){                x_admin_show('编辑','/admin-edit?username='+username+'&role='+role);            },            btnOK:function(data){                var _this = this;                // this.pageNum=this.pageNumber                if(_this.pageNumber>_this.totalPages){                    _this.pageNumber=_this.totalPages                    // this.pageNum=this.pageNumber                }                $.ajax({ type:'post',url: "/findAllUser", data: {pageNum:_this.pageNumber,pageSize:10}, contentType: "application/x-www-form-urlencoded",                    success: function(res){                        var dataObj=eval("("+res+")");                        _this.body = dataObj.list                        _this.pageNum=dataObj.pageNum                        _this.pageSize=dataObj.pageSize                        _this.isFirstPage=dataObj.isFirstPage                        _this.totalPages=dataObj.pages                        _this.isLastPage=dataObj.isLastPage                        _this.totalNum = dataObj.total                    }                });            },            btnClick: function(data){//页码点击事件                var _this = this;                _this.pageNumber = data                if(data != this.pageNum){                    $.ajax({ type:'post',url: "/findAllUser", data: {pageNum:data,pageSize:10}, contentType: "application/x-www-form-urlencoded",                        success: function(res){                            var dataObj=eval("("+res+")");                            // console.log("/btnClick")                            // console.log(dataObj)                            _this.body = dataObj.list                            _this.pageNum=dataObj.pageNum                            _this.pageSize=dataObj.pageSize                            _this.isFirstPage=dataObj.isFirstPage                            _this.totalPages=dataObj.pages                            _this.isLastPage=dataObj.isLastPage                            _this.totalNum = dataObj.total                        }                    });                }            },            pageClick: function(reccept,event) {                //父组件通过change方法来接受当前的页码                //这里是点击下一页执行函数                var _this = this                _this.pageNumber = _this.pageNum                $.ajax({ type:'post',url: "/findAllUser", data: {pageNum:_this.pageNum,pageSize:10}, contentType: "application/x-www-form-urlencoded",                    success: function(res){                        var dataObj=eval("("+res+")");                        // console.log("/btnClick")                        // console.log(dataObj)                        _this.body = dataObj.list                        _this.pageNum=dataObj.pageNum                        _this.pageSize=dataObj.pageSize                        _this.isFirstPage=dataObj.isFirstPage                        _this.totalPages=dataObj.pages                        _this.isLastPage=dataObj.isLastPage                        _this.totalNum = dataObj.total                    }                });            }        },        computed: {            indexs: function () {                this.all = Math.ceil(this.totalNum / this.pageSize);                // console.log(this.all)                var left = 1;                var right = this.all;                var ar = [];                if (this.all >= 5) {                    if (this.pageNum> 3 && this.pageNum < this.all - 2) {                        left = this.pageNum - 2                        right = this.pageNum + 2                    } else {                        if (this.pageNum <= 3) {                            left = 1                            right = 5                        } else {                            right = this.all                            left = this.all - 4                        }                    }                }                while (left <= right) {                    ar.push(left)                    left++                }                return ar            }        },        filters: {            formatDate: function (val) {                var value = new Date(val);                var year = value.getFullYear();                var month = padDate(value.getMonth() + 1);                var day = padDate(value.getDate());                var hour = padDate(value.getHours());                var minutes = padDate(value.getMinutes());                var seconds = padDate(value.getSeconds());                return year + '-' + month + '-' + day + ' ' + hour + ':' + minutes + ':' + seconds;            },            forRole:function (val) {                // console.log('forRole')                if(typeof(val) != "undefined"){                    return val.rolename                }else{                    return '-'                }            }        }    })</script></body></html>