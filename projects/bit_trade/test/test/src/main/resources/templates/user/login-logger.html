<html class="x-admin-sm" xmlns:v-on="http://www.w3.org/1999/xhtml" xmlns:v-bind="http://www.w3.org/1999/xhtml">

<head>
  <meta charset="UTF-8">
  <title>用户中心</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8" />
  <link rel="stylesheet" href="/statics/css/font.css">
  <link rel="stylesheet" href="/statics/css/xadmin.css">
  <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script type="text/javascript" src="/statics/lib/layui/layui.js" charset="utf-8"></script>
  <script type="text/javascript" src="/statics/js/xadmin.js"></script>
  <script type="text/javascript" src="/statics/js/cookie.js"></script>
  <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
  <!--[if lt IE 9]>
  <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
  <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->

</head>
<style>
  .searchBigBox {
    border: 1px solid #dedee1;
    padding-top: 20px;
    padding-left: 20px;
    padding-right: 20px;
    box-shadow: 0px 1px 1px 0px rgba(0, 0, 0, 0.2);
  }
  .searchItem {
    margin-right:10px;
  }

</style>

<body>
<div id="log">
  <div class="x-nav">
    <span class="layui-breadcrumb">
      <a href="">首页</a>
      <a href="">日志管理</a>
      <a>
        <cite>系统日志</cite></a>
    </span>
    <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:12px;float:right"
       href="javascript:location.replace(location.href);" title="刷新">
      <i class="layui-icon" style="line-height:25px"><img src="/statics/images/refresh2.png" alt="" style="width:16px;"></i></a>
  </div>
  <div class="x-body" id="oprateList">

    <xblock>
      <button class="layui-btn" onclick="searchs_show()"><i class="layui-icon">&#xe615;</i>查询</button>
      <span class="x-right" style="line-height:40px">共有数据：<font class="particular"><b>{{totalNum}}</b></font>条 <font class="particular"><b>{{pageNum}}/{{totalPages}}</b></font> 每页<font class="particular"><b>{{pageSize}}</b></font>条</span>

    </xblock>
    <!-- 搜索条件 -->
    <div class="layui-row searchBigBox" id="searchBox" style="overflow:visible;">
      <form class="layui-form layui-col-md12 x-so">
        <div class="form-group col-lg-3">
          <input type="text" name="operatorUser" placeholder="请输入操作人" autocomplete="off" class="layui-input searchItem" v-model="operatorUser">
          <input type="text" name="changeUser" placeholder="请输入被操作人" autocomplete="off" class="layui-input searchItem" v-model="changeUser">
          <!--<div class="layui-input-inline searchItem">-->
            <!--<select name="contrller">-->
              <!--<option>请选择操作人</option>-->
            <!--</select>-->
          <!--</div>-->
          <input class="layui-input searchItem" placeholder="开始时间" name="beginTime" id="start" v-model="beginTime">
          <input class="layui-input searchItem" placeholder="结束时间" name="endTime" id="end" v-model="endTime">
          <button class="layui-btn" @click.prevent="sreachs()" ><i class="layui-icon">&#xe615;</i></button>
          <button type="reset" class="layui-btn layui-btn-primary" @click.prevent="reset()">重置</button>
        </div>
      </form>
    </div>

    <table class="layui-table x-admin">
      <thead>
      <tr>
        <th>操作人</th>
        <th>被操作人</th>
        <th>日志时间</th>
        <th>日志名称</th>
        <th>日志内容</th>
      </tr>
      </thead>
      <tbody>
      <tr v-for="b in body">
        <td>{{b.operatorUser}}</td>
        <td>{{b.changeUser}}</td>
        <td>{{b.logTime | formatDate}}</td>
        <td>{{b.logName}}</td>
        <td>{{b.logContent}}</td>
      </tr>
      </tbody>
    </table>
    <div class="page">
      <a v-if="pageNum>1" v-on:click="pageNum--,pageClick()">&lt;&lt;</a>
      <a v-if="pageNum==1" class="num current">&lt;&lt;</a>
      <a v-for="index in indexs" v-bind:class="{'sefirst' : pageNum == index}" v-on:click="btnClick(index)">{{index}}</a>
      <a v-if="pageNum!=totalPages" v-on:click="pageNum++,pageClick()" class="num">&gt;&gt;</a>
      <a v-if="pageNum == totalPages" class="banclik">&gt;&gt;</a>
      <font style="color:#999;">到第</font>
      <input type="text" class="pageNumber" v-model="pageNumber">
      <font style="color:#999;">页</font>
      <button  class="pageOK" @click="btnOK()">确定</button>
    </div>
  </div>




</div>


<script src="/statics/js/vue.min.js"></script>
<script src="/statics/js/vue-resource.js"></script>
<script src="/statics/js/order_list.js"></script>
<script>

    var padDate=function(va) {
        va = va < 10 ? '0' + va : va;
        return va
    }

     var log = new Vue({
        el:"#log",
        data:{
            body:{},
            pageNum:1, //当前页数
            pageSize:1, //每页数量
            isFirstPage:false,
            totalPages:0, //总页数
            isLastPage:false,
            totalNum:0, //总数量
            operatorUser:'',
            changeUser:'',
            beginTime:'',
            endTime:'',
            pageNumber:1,
        },
        mounted:function () {
            var _this = this;
            this.$http.post('/log/systemLog',{emulateJSON:false}).then(function(res){
                console.log('/log/systemLog')
                console.log(res.body.list)
                _this.body = res.body.list
                _this.pageNum=res.body.pageNum
                _this.pageSize=res.body.pageSize
                _this.isFirstPage=res.body.isFirstPage
                _this.totalPages=res.body.pages
                _this.isLastPage=res.body.isLastPage
                _this.totalNum = res.body.total
                // console.log(res);
            },function(res){
                console.log(res.status);
            });
        },
         methods:{
             reset:function(){
               var _this = this;
                 _this.operatorUser=''
                 _this.changeUser=''
                 _this.beginTime=''
                 _this.endTime=''
             },
             sreachs:function () {
                 var _this = this;
                 this.$http.post('/log/systemLog',
                     {operatorUser:this.operatorUser,changeUser:this.changeUser,
                         beginTime:this.beginTime,endTime:this.endTime
                     },{emulateJSON:false}).then(function(res){
                     _this.body = res.body.list
                     _this.pageNum=res.body.pageNum
                     _this.pageSize=res.body.pageSize
                     _this.isFirstPage=res.body.isFirstPage
                     _this.totalPages=res.body.pages
                     _this.isLastPage=res.body.isLastPage
                     _this.totalNum = res.body.total
                 },function(res){
                     console.log(res.status);
                 });
             },
         btnClick: function(data){//页码点击事件
             var _this = this;
             _this.pageNumber = data
             if(data != this.pageNum){
                 // console.log(data)
                 this.$http.post('/log/systemLog',
                     {pageNum:data,pageSize:10},{emulateJSON:false}).then(function(res){

                     // console.log(res.body)
                     _this.body = res.body.list
                     _this.pageNum=res.body.pageNum
                     _this.pageSize=res.body.pageSize
                     _this.isFirstPage=res.body.isFirstPage
                     _this.totalPages=res.body.pages
                     _this.isLastPage=res.body.isLastPage
                     _this.totalNum = res.body.total
                     if(null == res){
                     }
                 },function(res){
                     console.log(res.status);
                 });

             }
         },
         pageClick: function(reccept,event) {
             //父组件通过change方法来接受当前的页码
             //这里是点击下一页执行函数
             var _this = this
             _this.pageNumber = _this.pageNum
             this.$http.post('/log/systemLog',
                 {pageNum:_this.pageNum,pageSize:10},{emulateJSON:false}).then(function(res){

                 // console.log(res.body)
                 _this.body = res.body.list
                 _this.pageNum=res.body.pageNum
                 _this.pageSize=res.body.pageSize
                 _this.isFirstPage=res.body.isFirstPage
                 _this.totalPages=res.body.pages
                 _this.isLastPage=res.body.isLastPage
                 _this.totalNum = res.body.total
                 if(null == res){
                 }
             },function(res){
                 console.log(res.status);
             });


         },btnOK:function(data){
                 var _this = this;
                 // this.pageNum=this.pageNumber
                 if(this.pageNumber>this.totalPages){
                     this.pageNumber=this.totalPages
                     // this.pageNum=this.pageNumber
                 }
                 this.$http.post('/log/systemLog',
                     {pageNum:this.pageNumber,pageSize:10},{emulateJSON:false}).then(function(res){
                     // console.log(res.body)
                     _this.body = res.body.list
                     _this.pageNum=res.body.pageNum
                     _this.pageSize=res.body.pageSize
                     _this.isFirstPage=res.body.isFirstPage
                     _this.totalPages=res.body.pages
                     _this.isLastPage=res.body.isLastPage
                     _this.totalNum = res.body.total
                 });

             },


     },computed: {
         indexs: function () {
             this.all = Math.ceil(this.totalNum / this.pageSize);
             // console.log(this.all)
             var left = 1;
             var right = this.all;

             var ar = [];
             if (this.all >= 5) {
                 if (this.pageNum> 3 && this.pageNum < this.all - 2) {
                     left = this.pageNum - 2
                     right = this.pageNum + 2
                 } else {
                     if (this.pageNum <= 3) {
                         left = 1
                         right = 5
                     } else {
                         right = this.all
                         left = this.all - 4
                     }
                 }
             }
             while (left <= right) {
                 ar.push(left)
                 left++
             }
             return ar
         }
     },filters: {
             formatDate: function (val) {
                 var value = new Date(val);
                 var year = value.getFullYear();
                 var month = padDate(value.getMonth() + 1);
                 var day = padDate(value.getDate());
                 var hour = padDate(value.getHours());
                 var minutes = padDate(value.getMinutes());
                 var seconds = padDate(value.getSeconds());
                 return year + '-' + month + '-' + day + ' ' + hour + ':' + minutes + ':' + seconds;

             }
         }
     })

    layui.use('laydate', function () {
        var _log = log;
        var laydate = layui.laydate;
        //执行一个laydate实例
        laydate.render({
            elem: '#start', //指定元素
            done:function (val) {
                _log.beginTime = val
            }

        });

        //执行一个laydate实例
        laydate.render({
            elem: '#end', //指定元素
            done:function (val) {
                _log.endTime = val
            }
        });
    });

    //Demo
    layui.use('form', function(){
        var form = layui.form;

        //监听提交
        form.on('submit(formDemo)', function(data){

            layer.msg(JSON.stringify(data.field));
            // console.log(JSON.stringify(data.field))
            // $.ajax({
            //     type:'post',
            //     url: "/manage/order/getPayOrderAll",
            //     contentType: "application/json;charset=utf-8",
            //     async : false,
            //     dataType : 'json',
            //     data :JSON.stringify(data.field),
            //     success: function(res){
            //         var _this = orderList;
            //         // var dataObj=eval("("+res+")");
            //         // // console.log("/btnClick")
            //         console.log(res)
            //         console.log(res.list)
            //         console.log(_this.orderList)
            //         _this.orderList = res.list
            //         _this.pageNum=res.pageNum
            //         _this.pageSize=res.pageSize
            //         _this.isFirstPage=res.isFirstPage
            //         _this.totalPages=res.pages
            //         _this.isLastPage=res.isLastPage
            //         _this.totalNum = res.total
            //     }
            //
            // });
            return false;
        });
    });
</script>

</body>

</html>