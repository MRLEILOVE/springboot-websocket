<!DOCTYPE html>
<html class="x-admin-sm" xmlns:v-on="http://www.w3.org/1999/xhtml" xmlns:v-bind="http://www.w3.org/1999/xhtml">

<head>
  <meta charset="UTF-8">
  <title>模块状态管理</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8" />
  <link rel="stylesheet" href="/statics/css/font.css">
  <link rel="stylesheet" href="/statics/css/xadmin.css">
  <script type="text/javascript" src="/statics/js/jquery-1.8.3.min.js"></script>
  <script type="text/javascript" src="/statics/lib/layui/layui.js" charset="utf-8"></script>
  <script type="text/javascript" src="/statics/js/xadmin.js"></script>
  <script type="text/javascript" src="/statics/js/cookie.js"></script>
  <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
  <!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<style>
  .searchBigBox {
    border: 1px solid #dedee1;
    padding-top: 20px;
    padding-left: 20px;
    padding-right: 20px;
    box-shadow: 0px 1px 1px 0px rgba(0, 0, 0, 0.2);
  }
  .searchItem {
    margin-right:10px;
    margin-bottom:10px;
  }

  .voice{
      background:#ea667f;
      padding:4px;
      color:#fff;
  }
  .online{
    background:#667eea;
      padding:4px; 
      color:#fff;
  }
  .free{
      background: #66eab4;
      padding:4px;
      color:#fff;
  }

</style>

<body>
  <div class="x-nav">
    <span class="layui-breadcrumb">
      <a href="">首页</a>
      <a href="">配置管理</a>
      <a>
        <cite>模块状态管理</cite></a>
    </span>
    <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:12px;float:right"
      href="javascript:location.replace(location.href);" title="刷新">
      <i class="layui-icon" style="line-height:25px"><img src="/statics/images/refresh2.png" alt="" style="width:16px;"></i></a>
  </div>
  <div class="x-body" id="deivceList">

    <xblock>
        <button class="layui-btn" onclick="searchs_show()"><i class="layui-icon">&#xe615;</i>查询</button>
        <span class="x-right" style="line-height:40px">共有数据：<font class="particular"><b>{{totalNum}}</b></font>条 <font class="particular"><b>{{pageNum}}/{{totalPages}}</b></font> 每页<font class="particular"><b>{{pageSize}}</b></font>条</span>
    </xblock>

      <!-- 搜索条件 -->
      <div class="layui-row searchBigBox" id="searchBox" style="overflow:visible;">
          <form class="layui-form layui-col-md12 x-so">
              <div class="form-group col-lg-3">
                  <input type="text" name="deviceUuid" placeholder="请输入设备UUID" autocomplete="off" class="layui-input searchItem" v-model="deviceUuid">

                  <div class="layui-input-inline searchItem">
                      <select name="deviceState" lay-ignore style="width:100px;height:30px;"  v-model="deviceState">
                          <option value="">状态</option>
                          <option value="1">在线</option>
                          <option value="0">离线</option>
                      </select>
                  </div>
                  <!--<div class="layui-input-inline searchItem">-->
                  <!--<select name="contrller">-->
                  <!--<option>请选择模块状态</option>-->
                  <!--</select>-->
                  <!--</div>-->
                  <button class="layui-btn" @click.prevent="sreachs()" ><i class="layui-icon">&#xe615;</i></button>
                  <button type="reset" class="layui-btn layui-btn-primary" @click.prevent="reset()">重置</button>
              </div>
          </form>
      </div>

    <table class="layui-table">
      <thead>
        <tr>
         <th>模块状态</th>
         <th>设备ICCID</th>
         <!--<th>工作状态</th>-->
         <th>网络制式</th>
         <th>运营商</th>
         <th>信号强度</th>
         <!--<th>心跳问题</th>-->
         <!--<th>设备离线次数</th>-->
         <th>设备UUID</th>
         <th>IP</th>
         <th>4G版本号</th>
         <th>主机软件版本号</th>
         <th>从机协议版本</th>
        </tr>
      </thead>
      <tbody>
      <tr v-for="item in deviceLists">
         <!--<td v-if="item.state=='语音播报'"><span class="voice" >{{item.state}}</span></td>-->
         <td v-if="item.deviceState == 1"><span class="online" >在线</span></td>
         <td v-else="item.deviceState == 0"><span class="online" >离线</span></td>
         <!--<td v-if="item.workState=='工作中'"><span class="online">{{item.deviceState}}</span></td>-->
         <!--<td v-else-if="item.workState=='空闲'"><span class="free">{{item.workState}}</span></td>-->
         <!--<td v-else-if="item.workState=='占用'"><span class="voice">{{item.workState}}</span></td>-->
          <td>{{item.iccId}}</td>
         <td>{{item.networkType}}</td>
         <td>{{item.networkOperator | operator}}</td>
         <td>{{item.deviceSignal}}</td>
         <!--<td>{{item.deviceOfflineNumber}}</td>-->
         <td>{{item.deviceUuid}}</td>
         <td>{{item.deviceIP}}</td>
         <td>{{item.softVersion}}</td>
         <td>{{item.hardVersion}}</td>
         <td>{{item.agreementVersion}}</td>
      </tr>
      </tbody>
    </table>

      <div class="page">
          <a v-if="pageNum>1" v-on:click="pageNum--,pageClick()">&lt;&lt;</a>
          <a v-if="pageNum==1" class="num current">&lt;&lt;</a>
          <a v-for="index in indexs" v-bind:class="{'sefirst' : pageNum == index}" v-on:click="btnClick(index)">{{index}}</a>
          <a v-if="pageNum!=totalPages" v-on:click="pageNum++,pageClick()" class="num">&gt;&gt;</a>
          <a v-if="pageNum == totalPages" class="banclik">&gt;&gt;</a>
          <font style="color:#999;">到第</font>
          <input type="text" class="pageNumber" v-model="pageNumber">
          <font style="color:#999;">页</font>
          <button  class="pageOK" @click="btnOK()">确定</button>
      </div>

  </div>
  <script src="/statics/js/vue.min.js"></script>
  <script src="/statics/js/vue-resource.js"></script>
  <!--<script src="/statics/js/order_list.js"></script>-->
  <script>

    layui.use('laydate', function () {
      var laydate = layui.laydate;
      //执行一个laydate实例
      laydate.render({
        elem: '#start' //指定元素
      });

      //执行一个laydate实例
      laydate.render({
        elem: '#end' //指定元素
      });
    });

  </script>

  <script>

      $("#searchBox").hide();
      function searchs_show() {
          $("#searchBox").toggle(200);
      }

      var deivceList = new Vue({

          el: '#deivceList',
          data: {
              inputtext:{},
              message:'',
              deviceLists:[],
              totals:'',
              deviceName :'',
              deviceUuid :'',
              deviceState:'',
              // startTime:'',
              // endTime:'',
              pageNum:1, //当前页数
              pageSize:1, //每页数量
              isFirstPage:false,
              totalPages:0, //总页数
              isLastPage:false,
              totalNum:0, //总数量
              pageNumber:1

          },
          methods: {
              reset:function(){
                  var _this = this;
                  _this.deviceUuid = '',
                  _this.deviceState = ''
              },
              sreachs:function () {
                  var _this = this;
                  this.$http.post('/device/listDate',
                      {deviceUuid:this.deviceUuid,deviceState:this.deviceState},{emulateJSON:false}).then(function(res){
                      _this.deviceLists = res.body.list;
                      // console.log("/device/listDate")
                      // console.log( res.body);
                      _this.pageNum=res.body.pageNum
                      _this.pageSize=res.body.pageSize
                      _this.isFirstPage=res.body.isFirstPage
                      _this.totalPages=res.body.pages
                      _this.isLastPage=res.body.isLastPage
                      _this.totalNum = res.body.total
                  },function(res){
                      console.log(res.status);
                  });
              },
              showDevice(id){
                  var url = '/device/deviceState?id='+id
                  x_admin_show('查看',url,600,500)
              },
              member_del(b){
                  layer.confirm('确认要删除吗？',function(index){
                      $.ajax({ type:'post',url: "/device/del", data: JSON.stringify(b), contentType: "application/json",
                          success: function(date){
                              //捉到所有被选中的，发异步进行删除
                              layer.msg('删除成功', {icon: 1});
                              $(".layui-form-checked").not('.header').parents('tr').remove();
                              location.reload();
                          }

                      });
                  });
              },
              btnClick: function(data){//页码点击事件
                  var _this = this;
                  _this.pageNumber = data
                  if(data != this.pageNum){
                      this.$http.post('/device/listDate',
                          {pageNum:data,pageSize:10},{emulateJSON:false}).then(function(res){

                          // console.log(res.body)
                          _this.deviceLists = res.body.list
                          _this.pageNum=res.body.pageNum
                          _this.pageSize=res.body.pageSize
                          _this.isFirstPage=res.body.isFirstPage
                          _this.totalPages=res.body.pages
                          _this.isLastPage=res.body.isLastPage
                          _this.totalNum = res.body.total
                          if(null == res){
                          }
                      },function(res){
                          console.log(res.status);
                      });

                  }
              },
              pageClick: function(reccept,event) {
                  //父组件通过change方法来接受当前的页码
                  //这里是点击下一页执行函数
                  var _this = this
                  _this.pageNumber = _this.pageNum
                  this.$http.post('/device/listDate',
                      {pageNum:_this.pageNum,pageSize:10},{emulateJSON:false}).then(function(res){
                      _this.deviceLists = res.body.list
                      _this.pageNum=res.body.pageNum
                      _this.pageSize=res.body.pageSize
                      _this.isFirstPage=res.body.isFirstPage
                      _this.totalPages=res.body.pages
                      _this.isLastPage=res.body.isLastPage
                      _this.totalNum = res.body.total
                      if(null == res){
                      }
                  },function(res){
                      console.log(res.status);
                  });


              },btnOK:function(data){
                  var _this = this;
                  // this.pageNum=this.pageNumber
                  if(_this.pageNumber>_this.totalPages){
                      _this.pageNumber=_this.totalPages
                      // this.pageNum=this.pageNumber
                  }
                  this.$http.post('/device/listDate',
                      {pageNum:_this.pageNumber,pageSize:10},{emulateJSON:false}).then(function(res){
                      _this.deviceLists = res.body.list
                      _this.pageNum=res.body.pageNum
                      _this.pageSize=res.body.pageSize
                      _this.isFirstPage=res.body.isFirstPage
                      _this.totalPages=res.body.pages
                      _this.isLastPage=res.body.isLastPage
                      _this.totalNum = res.body.total
                  });

              },


          },computed: {
              indexs: function () {
                  this.all = Math.ceil(this.totalNum / this.pageSize);
                  // console.log(this.all)
                  var left = 1;
                  var right = this.all;

                  var ar = [];
                  if (this.all >= 5) {
                      if (this.pageNum> 3 && this.pageNum < this.all - 2) {
                          left = this.pageNum - 2
                          right = this.pageNum + 2
                      } else {
                          if (this.pageNum <= 3) {
                              left = 1
                              right = 5
                          } else {
                              right = this.all
                              left = this.all - 4
                          }
                      }
                  }
                  while (left <= right) {
                      ar.push(left)
                      left++
                  }
                  return ar
              },
          },
          mounted:function () {
              var _this = this;
              this.$http.post('/device/listDate',
                  {},{emulateJSON:false}).then(function(res){
                  console.log("/device/listDate")
                  console.log(res.body)
                  _this.deviceLists = res.body.list
                  _this.pageNum=res.body.pageNum
                  _this.pageSize=res.body.pageSize
                  _this.isFirstPage=res.body.isFirstPage
                  _this.totalPages=res.body.pages
                  _this.isLastPage=res.body.isLastPage
                  _this.totalNum = res.body.total
                  if(null == res){

                  }
              },function(res){
                  console.log(res.status);
              });
          },

          filters: {
              formatDate: function (val) {
                  var value = new Date(val);
                  var year = value.getFullYear();
                  var month = padDate(value.getMonth() + 1);
                  var day = padDate(value.getDate());
                  var hour = padDate(value.getHours());
                  var minutes = padDate(value.getMinutes());
                  var seconds = padDate(value.getSeconds());
                  return year + '-' + month + '-' + day + ' ' + hour + ':' + minutes + ':' + seconds;

              },
              operator: function (val) {
                  return val=='YD' ? '移动' : (val=='DX' ? '电信' : (val == 'LT' ? '联通' : ''));
              }

          }
      })

  </script>
</body>

</html>