<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<meta charset="utf-8">
<style>
	.banner-box{
		width:50px;
		height:50px;
		border:1px solid #e5e6e7;
		/*background:url(../../img/banner-add.png) no-repeat center;*/
		background-size:45px 45px;
		position: relative;
		box-sizing: content-box;
	}
	.downloadPic{
		width:100%;
		height:100%;
		opacity: 0;
		position: absolute;
		top:0;
		left:0;
		z-index:2;
	}
	.banner-img{
		position: absolute;
		width:100%;
		height:100%;
		top:0;
		left:0;
		z-index:1;
	}
	.add-img{
		position: absolute;
		width:24px;
		height:24px;
		line-height:24px;
		text-align:center;
		left:0;
		bottom:0;
		top:0;
		right:0;
		margin:auto;
		font-size:32px;
		z-index:0;
	}
	.banner-size{
		float: right !important;
		margin-top: -15px;
	}
</style>
<head th:include="include :: header"></head>
<body class="white-bg">
	<div class="wrapper wrapper-content animated fadeInRight ibox-content">
		<form class="form-horizontal m" id="form-user-edit">
			<div class="form-group">
				<label class="col-sm-3 control-label ">中文名称：</label>
				<div class="col-sm-8">
					<input class="form-control" type="text" name="name" id="name" required/>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">关键字：</label>
				<div class="col-sm-8">
					<input class="form-control" type="text" name="keyword" id="keyword" required/>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">值：</label>
				<div class="col-sm-8">
					<input class="form-control" type="text" name="value" id="value" required>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">钱包类型：</label>
				<div class="col-sm-8">
					<input class="form-control" type="text" name="accountType" id="accountType" required>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">是否可以充币：</label>
				<div class="col-sm-8">
					<div class="onoffswitch">
						<input type="checkbox" th:checked="true"
							   class="onoffswitch-checkbox" id="topUpCoin" name="topUpCoin">
						<label class="onoffswitch-label" for="topUpCoin">
							<span class="onoffswitch-inner"></span>
							<span class="onoffswitch-switch"></span>
						</label>
					</div>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">是否可以提币：</label>
				<div class="col-sm-8">
					<div class="onoffswitch">
						<input type="checkbox" th:checked="true"
							   class="onoffswitch-checkbox" id="drawCoin" name="drawCoin">
						<label class="onoffswitch-label" for="drawCoin">
							<span class="onoffswitch-inner"></span>
							<span class="onoffswitch-switch"></span>
						</label>
					</div>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">图标：</label>
				<div class="col-sm-8">
					<div class="banner-box">
						<input class="downloadPic" type="file" name="file" id="downloadPic" accept="image/*" >
						<img class="banner-img" src="" alt="" id="bannerImgUrl">
						<p class="add-img">+</p>
					</div>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">排序：</label>
				<div class="col-sm-8">
					<input class="form-control" type="number" name="sort" id="sort" required min="1">
				</div>
			</div>
		</form>
	</div>
	<div th:include="include::footer"></div>
	<script th:src="@{/ajax/libs/select/select2.js}"></script>
	<script>
        $("#form-user-edit").validate({
        	submitHandler:function(form){
        		edit();
        	}
        });
		/* 图片在前端预览 */
		var pictureSuffix ="";
		var pictureBase64 = "";
		$("#downloadPic").change(function(e,type){
			var files = e.target.files;
			var file = files[0];
			var fileSize = file.size;
			if (!/\/(?:jpeg|jpg|png)/i.test(file.type)){
				$.modal.alertError("上传图片格式只能为jpeg,jpg,png");
				return;
			}
			var reader = new FileReader();
			reader.onload = function() {
				if(fileSize-0 > 1048576){
					$.modal.alertError("上传图片不能超过1M");
					return false;
				}
				var result = this.result;
				$("#bannerImgUrl").attr("src",result);
				/* console.log(result) */
				pictureSuffix = file.type.split("/")[1];
				pictureBase64 = result.split(",")[1];
				/* console.log(pictureSuffix,pictureBase64) */
			};
			reader.readAsDataURL(file);
		});
        function submitHandler() {
	        if ($.validate.form()) {
	        	edit();
	        }
	    }

        function edit() {
			var name = $("input[name='name']").val();
			var keyword = $("input[name='keyword']").val();
			var value = $("input[name='value']").val();
			var accountType = $("input[name='accountType']").val();
        	var topUpCoin = $("input[name='topUpCoin']").is(':checked') == true ? 1 : 2;
        	var drawCoin = $("input[name='drawCoin']").is(':checked') == true ? 1 : 2;
        	var sort=$("input[name='sort']").val();
        	$.ajax({
        		cache : true,
        		type : "POST",
        		url : ctx + "config/accountConfig/saveOrUpdate",
        		data : {
        			"name": name,
        			"keyword": keyword,
        			"value": value,
        			"accountType": accountType,
        			"topUpCoin": topUpCoin,
        			"drawCoin": drawCoin,
					"sort": sort,
					"pictureSuffix":pictureSuffix,
					"pictureBase64":pictureBase64
        		},
        		async : false,
        		error : function(request) {
        			$.modal.alertError("系统错误");
        		},
        		success : function(data) {
        			$.operate.saveSuccess(data);
        		}
        	});
        }
    </script>
</body>
</html>
