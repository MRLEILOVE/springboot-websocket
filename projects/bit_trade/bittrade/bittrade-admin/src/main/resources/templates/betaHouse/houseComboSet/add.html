<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<meta charset="utf-8">
<meta name="renderer" content="webkit">
<link rel="stylesheet" href="/static/build/layui.css" media="all">

<style>
    .banner-box {
        width: 350px;
        height: 150px;
        border: 1px solid #e5e6e7;
        /*background:url(../../img/banner-add.png) no-repeat center;*/
        background-size: 45px 45px;
        position: relative;
        box-sizing: content-box;
    }

    .downloadPic {
        width: 100%;
        height: 100%;
        opacity: 0;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 2;
    }

    .banner-img {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 1;
    }

    .add-img {
        position: absolute;
        width: 24px;
        height: 24px;
        line-height: 24px;
        text-align: center;
        left: 0;
        bottom: 0;
        top: 0;
        right: 0;
        margin: auto;
        font-size: 32px;
        z-index: 0;
    }

    .banner-size {
        float: right !important;
        margin-top: -15px;
    }
</style>

<head th:include="include :: header"></head>
<body class="white-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <form class="form-horizontal m" id="form-houseProduct-add">

        <div class="form-group">
            <label class="col-sm-3 control-label">公狗套餐名称：</label>
            <div class="col-sm-9">
                <select  class="form-control"  id="comboId" name="comboId" th:with="type=${list}">
                    <option th:each="dict : ${type}"
                            th:text="${dict.dogName +''+ dict.earningsRatio*100+'%'+'/ 价格'+dict.minPrice+'~'+dict.maxPrice}"
                            th:value="${dict.id}"></option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">套餐怀孕几率：</label>
            <div class="col-sm-9">
                <input class="form-control" type="text" name="fetationProbability" id="fetationProbability"
                       placeholder="0.0">
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">套餐最多怀孕数量：</label>
            <div class="col-sm-9">
                <input class="form-control" type="text"  maxlength="2" id="fetationMax" name="fetationMax" Mid="fetationMax"
                       placeholder="1~8"
                       oninput="selectnumber(this.value)">
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">小狗出生最低价格：</label>
            <div class="col-sm-9">
                <input class="form-control" type="text" name="minPrice" id="minPrice" placeholder="公狗套餐最低价格1~10%">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">小狗出生最高价格：</label>
            <div class="col-sm-9">
                <input class="form-control" type="text" name="maxPrice" id="maxPrice" placeholder="公狗套餐最高价格1~10%">
            </div>
        </div>

        <ul id="number">
        </ul>
    </form>
</div>
<div th:include="include::footer"></div>
<script th:src="@{/ajax/libs/select/select2.js}"></script>
<script>
    var prefix = ctx + "betaHouse/houseComboSet";

    function selectnumber(value) {
        $('#number').empty();
        var arr = [];
        for (var i = 1; i <= +value; i++) {
            arr.push('<li>' +
                '<div class="form-group">' +
                '<label class="col-sm-3 control-label" >第' + i + '条小狗出生几率</label>' +
                '<div class="col-sm-8">' +
                '<input type="hidden" value="' + i + '" class="fetationCount"/>' +
                '<input type="text" value="" class="fetationProbability"/>' +
                '</div>' +
                '</div>' +
                '</li>');
        }
        $('#number').html(arr.join(''));
    }

    function formSubmit() {
        var formData = {
            comboId: $("#comboId").val(),
            fetationProbability: $("#fetationProbability").val(),
            minPrice: $("#minPrice").val(),
            maxPrice: $("#maxPrice").val(),
            fetationMax: $("#fetationMax").val(),
            houseComboSetDetail: []
        };
        var numbersEl = $('#number li');
        for (var i = 0; i < numbersEl.length; i++) {
            formData.houseComboSetDetail.push({
                fetationCount: $(numbersEl[i]).find('.fetationCount').val(),
                fetationProbability: $(numbersEl[i]).find('.fetationProbability').val(),
            })
        }
        var detail = formData.houseComboSetDetail;
        var count = 0;
        for (var key in detail) {
            count += +detail[key].fetationProbability;
        }
        if (count != 1) {
            // return alert('套餐怀孕几率累加必须等于1');
            return layer.alert('套餐怀孕几率累加必须等于1')
        }

        $.ajax({
            url: prefix + '/saveHouseComboSet',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            error: function (request) {
                $.modal.alertError(request.data.message);
            },
            success: function (data) {
                if (data.code == web_status.SUCCESS) {
                    isFirst = false;
                    $.operate.saveSuccess(data);
                } else {
                    $.modal.alertError(data.message);
                }
            }
        })

    }

    window.onload = function () {
        selectnumber($('#fetationMax').val());
    }
    var isFirst = true;
    /* 首次执行提交 */
    $("#form-houseProduct-add").validate({});

    function submitHandler() {
        if ($.validate.form()) {
            if (isFirst) {
                formSubmit();
            }
        }
    }


</script>
</body>
</html>
