<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jdcloud.provider.mapper.RecordSmsLogMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.jdcloud.provider.pojo.RecordSmsLog">
        <id column="id" property="id" />
        <result column="create_time" property="createTime" />
        <result column="buy_id" property="buyId" />
        <result column="buy_name" property="buyName" />
        <result column="sell_id" property="sellId" />
        <result column="sell_name" property="sellName" />
        <result column="type" property="type" />
        <result column="order_id" property="orderId" />

        <result column="phone" property="phone" />
        <result column="content" property="content" />
    </resultMap>

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultVoMap" type="com.jdcloud.provider.pojo.vo.RecordSmsLogVo">
        <id column="id" property="id" />
        <result column="create_time" property="createTime" />
        <result column="buy_id" property="buyId" />
        <result column="buy_name" property="buyName" />
        <result column="sell_id" property="sellId" />
        <result column="sell_name" property="sellName" />
        <result column="type" property="type" />
        <result column="order_id" property="orderId" />

        <result column="phone" property="phone" />
        <result column="content" property="content" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, create_time AS createTime, buy_id AS buyId, buy_name AS buyName, sell_id AS sellId, sell_name AS sellName, type,order_id AS orderId
    </sql>

    <sql id="Base_Column_List_vo">
        rsl.id,
        rsl.create_time AS createTime,
        rsl.type,
        rsl.order_id AS order_Id,
        rsl.order_id as orderId,
        pcb.`name` AS buyName,
        pcb.`phone` AS buyPhone,
        pcs.`name` AS sellName,
        pcs.`phone` AS sellPhone
    </sql>

    <select id="selectRecordSmsLogPageList" resultMap="BaseResultVoMap">
        SELECT
        <include refid="Base_Column_List_vo"/>
        FROM g_record_sms_log rsl
        LEFT JOIN c_personal_card pcb ON rsl.buy_id = pcb.user_id
        LEFT JOIN c_personal_card pcs ON rsl.sell_id = pcs.user_id
        <where>
            <if test="dto.keyword !=null and dto.keyword != ''">
                AND concat(IFNULL(pcb.`name`, ''),IFNULL(pcs.`name`, '')) like concat('%',#{dto.keyword}, '%')
            </if>
            <if test="dto.params.beginTime != null and dto.params.beginTime != ''">
                and DATE_FORMAT(rsl.create_time, '%Y-%m-%d') &gt;= DATE_FORMAT(#{dto.params.beginTime}, '%Y-%m-%d')
            </if>
            <if test="dto.params.endTime != null and dto.params.endTime !=''">
                and DATE_FORMAT(rsl.create_time, '%Y-%m-%d') &lt;= DATE_FORMAT(#{dto.params.endTime}, '%Y-%m-%d')
            </if>
            <if test="dto.type ==null">
                and  rsl.type &lt;=2
            </if>
        </where>
    </select>


    <select id="selectNoAdoptSMSList" resultMap="BaseResultVoMap">
        SELECT
        rsl.id,
        rsl.create_time AS createTime,
        rsl.type,
        rsl.phone,
        rsl.content
        FROM g_record_sms_log rsl
        where 1=1
        <if test="dto.params.beginTime != null and dto.params.beginTime != ''">
            and DATE_FORMAT(rsl.create_time, '%Y-%m-%d') &gt;= DATE_FORMAT(#{dto.params.beginTime}, '%Y-%m-%d')
        </if>
        <if test="dto.params.endTime != null and dto.params.endTime !=''">
            and DATE_FORMAT(rsl.create_time, '%Y-%m-%d') &lt;= DATE_FORMAT(#{dto.params.endTime}, '%Y-%m-%d')
        </if>
        <if test="dto.phone !=null and dto.phone != ''">
            AND rsl.phone like concat(#{dto.phone}, '%')
        </if>
        <if test="dto.type !=null and dto.type != ''">
            and  rsl.type =#{dto.type}
        </if>
    </select>

</mapper>
